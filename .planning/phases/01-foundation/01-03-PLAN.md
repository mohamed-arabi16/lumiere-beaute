---
phase: 01-foundation
plan: 03
type: execute
wave: 2
depends_on:
  - "01-01"
files_modified:
  - src/i18n/config.ts
  - src/i18n/locales/tr/common.json
  - src/i18n/locales/en/common.json
  - src/i18n/locales/ar/common.json
  - src/providers/ThemeProvider.tsx
  - src/providers/AppProviders.tsx
  - src/hooks/useTheme.ts
  - src/hooks/useDirection.ts
  - src/main.tsx
autonomous: true
requirements:
  - FNDTN-02
  - FNDTN-03
  - FNDTN-04
  - FNDTN-05

must_haves:
  truths:
    - "Calling i18n.changeLanguage('ar') sets document.documentElement.dir = 'rtl' automatically"
    - "Calling i18n.changeLanguage('tr') or ('en') sets document.documentElement.dir = 'ltr' automatically"
    - "Browser configured to Arabic auto-detects language on first visit (no localStorage saved yet)"
    - "The app detects Turkish as fallback for any unsupported browser language"
    - "ThemeProvider reads localStorage on mount and syncs React state with the HTML class already applied by blocking script"
    - "toggleTheme() flips dark class on <html> and persists to localStorage"
  artifacts:
    - path: "src/i18n/config.ts"
      provides: "i18next initialization with bundled resources and browser language detection"
      contains: "fallbackLng: 'tr'"
    - path: "src/i18n/locales/tr/common.json"
      provides: "Turkish translation strings for Phase 1 test + nav skeleton"
      contains: "test"
    - path: "src/i18n/locales/en/common.json"
      provides: "English translation strings"
      contains: "test"
    - path: "src/i18n/locales/ar/common.json"
      provides: "Arabic translation strings"
      contains: "test"
    - path: "src/providers/ThemeProvider.tsx"
      provides: "Dark/light mode context with localStorage persistence"
      contains: "ThemeContext"
    - path: "src/providers/AppProviders.tsx"
      provides: "Composed provider tree: ThemeProvider + I18nextProvider"
      contains: "I18nextProvider"
    - path: "src/hooks/useTheme.ts"
      provides: "useTheme hook returning { theme, toggleTheme }"
      contains: "useTheme"
    - path: "src/hooks/useDirection.ts"
      provides: "useDirection hook returning { dir, isRTL } with DOM side effect"
      contains: "i18n.dir(i18n.language)"
    - path: "src/main.tsx"
      provides: "App entry point wrapped in AppProviders"
      contains: "AppProviders"
  key_links:
    - from: "src/i18n/config.ts"
      to: "i18next-browser-languagedetector"
      via: ".use(LanguageDetector)"
      pattern: "use\\(LanguageDetector\\)"
    - from: "src/hooks/useDirection.ts"
      to: "document.documentElement.dir"
      via: "useEffect on i18n.language change"
      pattern: "documentElement\\.dir"
    - from: "src/providers/ThemeProvider.tsx"
      to: "document.documentElement.classList"
      via: "useEffect on theme state change"
      pattern: "classList.toggle.*dark"
    - from: "src/main.tsx"
      to: "src/providers/AppProviders.tsx"
      via: "wrapping App in AppProviders"
      pattern: "AppProviders"
---

<objective>
Create the complete i18n and theming provider infrastructure: i18next config with bundled trilingual resources and browser language detection, ThemeProvider with localStorage persistence, AppProviders composition, and the useTheme/useDirection hooks. Update main.tsx to wrap App in AppProviders.

Purpose: This is the behavioral foundation — language switching, RTL direction, and dark mode persistence. Every interactive element in the site depends on these hooks and providers being correct from the start.

Output: 9 new/modified files providing full i18n + theme infrastructure, importable by any component in subsequent phases.
</objective>

<execution_context>
@/Users/mohamedkhair/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mohamedkhair/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/1-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create i18n config with bundled trilingual resources and browser language detection</name>
  <files>
    src/i18n/config.ts,
    src/i18n/locales/tr/common.json,
    src/i18n/locales/en/common.json,
    src/i18n/locales/ar/common.json
  </files>
  <action>
Create the i18n directory structure and files. Use bundled resources (not HTTP backend) to avoid async loading delay that causes flash of untranslated keys.

**`src/i18n/locales/tr/common.json`** — Turkish (Phase 1 test strings + nav skeleton):
```json
{
  "nav": {
    "home": "Ana Sayfa",
    "services": "Hizmetler",
    "academy": "Akademi",
    "about": "Hakkımızda",
    "contact": "İletişim"
  },
  "test": {
    "heading": "Lumiere Beaute",
    "body": "Güzellik ve zarafet, her dilde.",
    "colorLabel": "Renk paleti",
    "toggleTheme": "Tema Değiştir",
    "dir": "Yön",
    "lang": "Dil"
  }
}
```

**`src/i18n/locales/en/common.json`** — English:
```json
{
  "nav": {
    "home": "Home",
    "services": "Services",
    "academy": "Academy",
    "about": "About",
    "contact": "Contact"
  },
  "test": {
    "heading": "Lumiere Beaute",
    "body": "Beauty and elegance, in every language.",
    "colorLabel": "Color palette",
    "toggleTheme": "Toggle Theme",
    "dir": "Direction",
    "lang": "Language"
  }
}
```

**`src/i18n/locales/ar/common.json`** — Arabic (right-to-left):
```json
{
  "nav": {
    "home": "الرئيسية",
    "services": "الخدمات",
    "academy": "الأكاديمية",
    "about": "من نحن",
    "contact": "تواصل معنا"
  },
  "test": {
    "heading": "لوميير بيوتي",
    "body": "الجمال والأناقة، بكل لغة.",
    "colorLabel": "لوحة الألوان",
    "toggleTheme": "تبديل المظهر",
    "dir": "الاتجاه",
    "lang": "اللغة"
  }
}
```

**`src/i18n/config.ts`** — i18next initialization:
```typescript
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';

import trCommon from './locales/tr/common.json';
import enCommon from './locales/en/common.json';
import arCommon from './locales/ar/common.json';

i18n
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    resources: {
      tr: { common: trCommon },
      en: { common: enCommon },
      ar: { common: arCommon },
    },
    defaultNS: 'common',
    fallbackLng: 'tr',
    supportedLngs: ['tr', 'en', 'ar'],
    detection: {
      order: ['localStorage', 'navigator', 'htmlTag'],
      caches: ['localStorage'],
      lookupLocalStorage: 'i18nextLng',
    },
    interpolation: {
      escapeValue: false,
    },
  });

export default i18n;
```

Key notes:
- `order: ['localStorage', 'navigator', 'htmlTag']` — checks stored preference first, then browser language, then HTML lang attribute
- `fallbackLng: 'tr'` — Turkish is default for unrecognized languages
- `supportedLngs: ['tr', 'en', 'ar']` — constrains detection to only these three; prevents i18next from using 'en-US' when only 'en' resources exist
- Import JSON files directly (NOT via HTTP backend) — synchronous, no flash of untranslated keys
  </action>
  <verify>
In a test component or browser console after app loads: `import i18n from './i18n/config'; console.log(i18n.language)` — should log 'tr' (or browser language if detected). `i18n.changeLanguage('ar')` then `i18n.dir(i18n.language)` should return 'rtl'. `i18n.t('test.heading')` should return 'Lumiere Beaute' in any language.
  </verify>
  <done>
All 4 files exist. `i18n.language` resolves to detected browser language or 'tr' fallback. `i18n.dir('ar')` returns 'rtl'. `i18n.dir('tr')` returns 'ltr'. Translation keys in `test.*` and `nav.*` namespaces resolve to correct strings in all three languages.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ThemeProvider, AppProviders, hooks, and wire up main.tsx</name>
  <files>
    src/providers/ThemeProvider.tsx,
    src/providers/AppProviders.tsx,
    src/hooks/useTheme.ts,
    src/hooks/useDirection.ts,
    src/main.tsx
  </files>
  <action>
Create the provider and hook files. These form the React context layer that makes theme and direction state accessible to all components.

**`src/providers/ThemeProvider.tsx`:**
```typescript
import { createContext, useContext, useEffect, useState, type ReactNode } from 'react';

type Theme = 'light' | 'dark';

interface ThemeContextType {
  theme: Theme;
  toggleTheme: () => void;
}

const ThemeContext = createContext<ThemeContextType | null>(null);

export function ThemeProvider({ children }: { children: ReactNode }) {
  const [theme, setTheme] = useState<Theme>(() => {
    // Sync React state with what the blocking script already applied to the DOM
    // This prevents a React re-render from undoing the blocking script's work
    const saved = localStorage.getItem('theme') as Theme | null;
    if (saved === 'dark' || saved === 'light') return saved;
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  });

  useEffect(() => {
    document.documentElement.classList.toggle('dark', theme === 'dark');
    localStorage.setItem('theme', theme);
  }, [theme]);

  const toggleTheme = () => setTheme(t => (t === 'light' ? 'dark' : 'light'));

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

export function useTheme() {
  const ctx = useContext(ThemeContext);
  if (!ctx) throw new Error('useTheme must be used inside ThemeProvider');
  return ctx;
}
```

**`src/hooks/useTheme.ts`** — re-exports from ThemeProvider for clean import paths:
```typescript
export { useTheme } from '../providers/ThemeProvider';
```

**`src/hooks/useDirection.ts`:**
```typescript
import { useEffect } from 'react';
import { useTranslation } from 'react-i18next';

export function useDirection() {
  const { i18n } = useTranslation();
  // Always pass i18n.language explicitly — omitting it can return undefined in some i18next versions
  const dir = i18n.dir(i18n.language) as 'ltr' | 'rtl';
  const isRTL = dir === 'rtl';

  useEffect(() => {
    // Keep DOM attributes in sync whenever language changes
    document.documentElement.dir = dir;
    document.documentElement.lang = i18n.language;
  }, [i18n.language, dir]);

  return { dir, isRTL };
}
```

**`src/providers/AppProviders.tsx`** — composes all providers in correct nesting order (ThemeProvider outer, I18nextProvider inner):
```typescript
import { type ReactNode } from 'react';
import { I18nextProvider } from 'react-i18next';
import i18n from '../i18n/config';
import { ThemeProvider } from './ThemeProvider';

export function AppProviders({ children }: { children: ReactNode }) {
  return (
    <ThemeProvider>
      <I18nextProvider i18n={i18n}>
        {children}
      </I18nextProvider>
    </ThemeProvider>
  );
}
```

Note: BrowserRouter is NOT added here — it belongs in Phase 2 (Shell) when routing is set up. AppProviders will be updated in Phase 2 to add BrowserRouter.

**`src/main.tsx`** — update to wrap App in AppProviders and import globals CSS:
```typescript
import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import { AppProviders } from './providers/AppProviders';
import App from './App';
import './index.css';

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <AppProviders>
      <App />
    </AppProviders>
  </StrictMode>,
);
```
  </action>
  <verify>
Run `npm run dev`. Open browser. In DevTools console run:
1. `document.documentElement.classList.contains('dark')` — matches what was in localStorage
2. In the React DevTools, confirm ThemeContext and I18nextProvider appear in the component tree wrapping App
3. `npx tsc --noEmit` exits 0 (no TypeScript errors in new files)
  </verify>
  <done>
All 5 files exist with correct content. `npx tsc --noEmit` passes. React DevTools shows ThemeProvider and I18nextProvider wrapping the App component. `useTheme()` returns `{ theme, toggleTheme }`. `useDirection()` returns `{ dir, isRTL }` matching current language.
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. `npx tsc --noEmit` exits 0 — all TypeScript files compile cleanly
3. React DevTools: ThemeProvider and I18nextProvider are in component tree above App
4. `i18n.changeLanguage('ar')` → `document.documentElement.dir` becomes 'rtl'
5. `i18n.changeLanguage('tr')` → `document.documentElement.dir` becomes 'ltr'
6. `toggleTheme()` from useTheme → `document.documentElement.classList` toggles 'dark'
7. After toggling dark and hard-reloading, dark mode persists (localStorage + blocking script)
8. All locale JSON files exist at src/i18n/locales/{tr,en,ar}/common.json
</verification>

<success_criteria>
The complete behavioral infrastructure is in place. Any component can call `useTheme()` for dark/light state, `useDirection()` for RTL/LTR, and `useTranslation('common')` for localized strings. Language changes automatically sync the HTML dir attribute. Theme changes persist to localStorage.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
