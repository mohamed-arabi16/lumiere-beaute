---
phase: 02-shell
plan: 03
type: execute
wave: 2
depends_on:
  - "02-01"
  - "02-02"
files_modified:
  - src/layouts/AnimatedOutlet.tsx
  - src/layouts/RootLayout.tsx
  - src/pages/HomePage.tsx
  - src/pages/ServicesPage.tsx
  - src/pages/AcademyPage.tsx
  - src/pages/AboutPage.tsx
  - src/pages/ContactPage.tsx
  - vercel.json
autonomous: true
requirements:
  - FNDTN-06
  - FNDTN-07
  - NAV-01
  - NAV-02

must_haves:
  truths:
    - "Navigating between any two routes produces a visible enter and exit animation with no flash"
    - "The Navbar persists across all route changes without flickering or re-mounting"
    - "Each stub page renders its page name as a heading using the nav translation key"
    - "Direct URL access to /services (or any route) works correctly without 404"
    - "Page transitions play in the correct direction for the active language (LTR vs RTL)"
    - "Scroll position resets to top on each route change"
  artifacts:
    - path: "src/layouts/AnimatedOutlet.tsx"
      provides: "useOutlet + cloneElement bridge between React Router and AnimatePresence"
      exports: ["AnimatedOutlet"]
      contains: "AnimatePresence"
    - path: "src/layouts/RootLayout.tsx"
      provides: "Persistent Navbar + AnimatedOutlet wrapper; syncs dir/lang via useDirection"
      exports: ["RootLayout"]
    - path: "src/pages/HomePage.tsx"
      provides: "Home page stub with pageTransitionVariants motion.div wrapper"
      exports: ["HomePage"]
    - path: "src/pages/ServicesPage.tsx"
      provides: "Services page stub with pageTransitionVariants"
      exports: ["ServicesPage"]
    - path: "src/pages/AcademyPage.tsx"
      provides: "Academy page stub with pageTransitionVariants"
      exports: ["AcademyPage"]
    - path: "src/pages/AboutPage.tsx"
      provides: "About page stub with pageTransitionVariants"
      exports: ["AboutPage"]
    - path: "src/pages/ContactPage.tsx"
      provides: "Contact page stub with pageTransitionVariants"
      exports: ["ContactPage"]
    - path: "vercel.json"
      provides: "SPA catch-all rewrite rule for direct URL access"
      contains: "rewrites"
  key_links:
    - from: "src/layouts/AnimatedOutlet.tsx"
      to: "src/layouts/RootLayout.tsx"
      via: "AnimatedOutlet component import"
      pattern: "AnimatedOutlet"
    - from: "src/layouts/AnimatedOutlet.tsx"
      to: "AnimatePresence"
      via: "framer-motion import with mode='wait' initial={false}"
      pattern: "mode.*wait"
    - from: "src/layouts/RootLayout.tsx"
      to: "src/components/navigation/Navbar.tsx"
      via: "Navbar component render"
      pattern: "<Navbar"
    - from: "src/pages/HomePage.tsx"
      to: "src/animations/variants.ts"
      via: "pageTransitionVariants import + custom={dir}"
      pattern: "pageTransitionVariants"
---

<objective>
Assemble the complete application shell by replacing stub files with real implementations: AnimatedOutlet bridges React Router with Framer Motion, RootLayout composes Navbar + AnimatedOutlet, and five page stubs each wrap their content in the RTL-aware transition motion.div.

Purpose: Plans 01 and 02 created all the building blocks. This plan assembles them into the working shell — the first time a real page transition animation is visible in the browser.
Output: Functional RootLayout with Navbar + AnimatedOutlet, five page stubs with transition wrappers, Vercel SPA routing config.
</objective>

<execution_context>
@/Users/mohamedkhair/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mohamedkhair/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/02-shell/2-RESEARCH.md
@.planning/phases/02-shell/02-01-SUMMARY.md
@.planning/phases/02-shell/02-02-SUMMARY.md
@src/animations/variants.ts
@src/hooks/useDirection.ts
@src/i18n/locales/en/common.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build AnimatedOutlet and RootLayout</name>
  <files>src/layouts/AnimatedOutlet.tsx, src/layouts/RootLayout.tsx</files>
  <action>
    Create src/layouts/AnimatedOutlet.tsx:
    - Import React from 'react'
    - Import useLocation, useOutlet from 'react-router-dom'
    - Import AnimatePresence from 'framer-motion'
    - Implement the verified useOutlet + cloneElement pattern:
      ```typescript
      export function AnimatedOutlet() {
        const location = useLocation();
        const element = useOutlet();

        return (
          <AnimatePresence mode="wait" initial={false}>
            {element && React.cloneElement(element, { key: location.pathname })}
          </AnimatePresence>
        );
      }
      ```
    - mode="wait": old page finishes exit BEFORE new page enters (required for cinematic feel)
    - initial={false}: first page load appears instantly — no entrance animation on initial render
    - key={location.pathname}: route change flips the key, AnimatePresence detects it and runs exit on old + enter on new
    - DO NOT wrap Outlet directly in AnimatePresence — this pattern is the ONLY way exit animations work with React Router
    - DO NOT place AnimatePresence inside any page component — it must be ABOVE the animated element

    Create src/layouts/RootLayout.tsx:
    - Import Navbar from '../components/navigation/Navbar'
    - Import AnimatedOutlet from './AnimatedOutlet'
    - Import ScrollRestoration from 'react-router-dom'
    - Import useDirection from '../hooks/useDirection'
    - useDirection() already syncs document.documentElement.dir and lang on language change (from Phase 1 hook)
    - DO NOT add a second useEffect for dir/lang — useDirection hook handles it — calling useDirection() here is sufficient
    - DO NOT add another useEffect for theme class — ThemeProvider already manages dark class on html element
    - RootLayout structure:
      ```typescript
      export function RootLayout() {
        useDirection(); // syncs dir + lang to <html> on language change
        return (
          <div className="min-h-screen bg-surface-ivory dark:bg-surface-dark transition-colors duration-300">
            <Navbar />
            <main>
              <AnimatedOutlet />
            </main>
            <ScrollRestoration />
          </div>
        );
      }
      ```
    - Navbar is OUTSIDE <main> and OUTSIDE AnimatePresence — it never participates in page transitions
    - ScrollRestoration resets scroll to top on navigation (costs nothing, prevents regression)
    - The outer div's bg-surface-ivory/dark matches globals.css html background so no visual gap between navbar and page
    - transition-colors duration-300 enables smooth theme switching at the layout level
  </action>
  <verify>Run `npx tsc --noEmit` — zero errors. Confirm AnimatedOutlet.tsx contains `mode="wait"` and `initial={false}`. Confirm RootLayout.tsx imports Navbar and AnimatedOutlet and calls useDirection().</verify>
  <done>AnimatedOutlet.tsx implements useOutlet + cloneElement pattern with AnimatePresence mode="wait" initial={false}. RootLayout.tsx renders Navbar + main + AnimatedOutlet + ScrollRestoration. TypeScript compiles clean.</done>
</task>

<task type="auto">
  <name>Task 2: Build five page stubs and vercel.json</name>
  <files>src/pages/HomePage.tsx, src/pages/ServicesPage.tsx, src/pages/AcademyPage.tsx, src/pages/AboutPage.tsx, src/pages/ContactPage.tsx, vercel.json</files>
  <action>
    Replace the stub files created in Plan 01 with real page stubs.
    All five pages follow the identical pattern — only the translation key and displayed name differ.

    Pattern for each page (use this exact structure):
    ```typescript
    import { motion } from 'framer-motion';
    import { useTranslation } from 'react-i18next';
    import { useDirection } from '../hooks/useDirection';
    import { pageTransitionVariants } from '../animations/variants';

    export function [PageName]Page() {
      const { t } = useTranslation('common');
      const { dir } = useDirection();

      return (
        <motion.div
          custom={dir}
          variants={pageTransitionVariants}
          initial="initial"
          animate="animate"
          exit="exit"
          className="min-h-screen px-4 py-16 sm:px-6 lg:px-8"
        >
          <div className="mx-auto max-w-7xl">
            <h1 className="font-display text-4xl text-stormy-teal-950 dark:text-celadon-100">
              {t('nav.[key]')}
            </h1>
            <p className="mt-4 font-body text-seagrass-600 dark:text-seagrass-400">
              Phase 2 stub — content coming in Phase 4
            </p>
          </div>
        </motion.div>
      );
    }
    ```

    Apply to each page:
    - src/pages/HomePage.tsx: export function HomePage, t('nav.home')
    - src/pages/ServicesPage.tsx: export function ServicesPage, t('nav.services')
    - src/pages/AcademyPage.tsx: export function AcademyPage, t('nav.academy')
    - src/pages/AboutPage.tsx: export function AboutPage, t('nav.about')
    - src/pages/ContactPage.tsx: export function ContactPage, t('nav.contact')

    CRITICAL — custom prop placement:
    - The `custom={dir}` prop goes on the motion.div INSIDE the page component (not on AnimatePresence)
    - AnimatePresence automatically passes `custom` down to the exiting component — this is how RTL exit direction works correctly

    CRITICAL — imports:
    - Import motion from 'framer-motion' (not from 'motion/react' — project uses framer-motion package per STATE.md decisions)
    - pageTransitionVariants from '../animations/variants' (relative path from pages/ directory)
    - useDirection from '../hooks/useDirection'

    Create vercel.json at project root:
    ```json
    {
      "rewrites": [
        { "source": "/(.*)", "destination": "/index.html" }
      ]
    }
    ```
    This catch-all rewrite ensures direct URL access to /services, /academy etc. works without 404.
    Required because BrowserRouter (HTML5 history API) serves all routes from index.html.
  </action>
  <verify>
    Run `npx tsc --noEmit` — zero errors across all five page files.
    Run `npm run dev` — visit http://localhost:5173/services directly in browser — page loads without 404 in dev mode.
    Navigate between Home and Services using browser nav links — verify smooth transition animation plays.
    Check browser console — zero errors.
  </verify>
  <done>Five page stubs exist with motion.div + pageTransitionVariants + custom={dir}. vercel.json created with catch-all rewrite. TypeScript compiles clean. Dev server shows animated page transitions when navigating between routes. Navbar persists and never re-mounts during navigation.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors across entire project
- `npm run dev` — no console errors, application renders with Navbar visible
- Visiting http://localhost:5173/ shows Home stub page with Navbar
- Clicking Services link shows Services stub page — transition animation plays (slide + fade)
- Navigating back to Home — exit animation plays on Services, enter animation plays on Home
- Navbar does not flicker or re-render during navigation
- Switching language to Arabic — subsequent page transition animates from opposite direction
- vercel.json exists at project root with rewrite rule
</verification>

<success_criteria>
Complete application shell is live: sticky Navbar with language/theme controls visible on all pages; animated page transitions with mode="wait" cinematic feel; five navigable stub pages; scroll restoration on navigation; Vercel SPA routing configured. TypeScript compiles clean across entire project.
</success_criteria>

<output>
After completion, create `.planning/phases/02-shell/02-03-SUMMARY.md`
</output>
