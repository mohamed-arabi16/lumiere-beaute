---
phase: 03-shared-components
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/providers/AppProviders.tsx
  - src/animations/variants.ts
autonomous: true
requirements:
  - SC3-4
  - SC3-1
  - SC3-3

must_haves:
  truths:
    - "MotionConfig wraps the entire app as the outermost provider so all motion components respect prefers-reduced-motion automatically"
    - "variants.ts exports fadeInUpVariants, staggerContainerVariants, and staggerItemVariants ready for use by animation components"
  artifacts:
    - path: "src/providers/AppProviders.tsx"
      provides: "MotionConfig reducedMotion=user wrapping full provider tree"
      contains: "MotionConfig"
    - path: "src/animations/variants.ts"
      provides: "Scroll-reveal and stagger variant exports alongside existing page transition variants"
      exports: ["fadeInUpVariants", "staggerContainerVariants", "staggerItemVariants"]
  key_links:
    - from: "src/providers/AppProviders.tsx"
      to: "motion components tree-wide"
      via: "MotionConfig reducedMotion='user' as outermost wrapper"
      pattern: "MotionConfig.*reducedMotion"
    - from: "src/animations/variants.ts"
      to: "src/components/animations/FadeInSection.tsx"
      via: "named import of fadeInUpVariants"
      pattern: "fadeInUpVariants"
---

<objective>
Wire the global prefers-reduced-motion guard and extend the shared variant library so animation components built in Plan 02 have the correct infrastructure.

Purpose: MotionConfig at provider level is the zero-maintenance accessibility baseline — one declaration covers every motion component in the app. The variants extension centralises animation timing constants so FadeInSection and StaggerContainer import rather than duplicate values.
Output: Modified AppProviders.tsx with MotionConfig as outermost wrapper; variants.ts with three new named exports.
</objective>

<execution_context>
@/Users/mohamedkhair/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mohamedkhair/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/providers/AppProviders.tsx
@src/animations/variants.ts
@.planning/phases/03-shared-components/3-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add MotionConfig to AppProviders as outermost wrapper</name>
  <files>src/providers/AppProviders.tsx</files>
  <action>
    Add `import { MotionConfig } from 'motion/react'` at the top of AppProviders.tsx.

    Wrap the entire return tree with `&lt;MotionConfig reducedMotion="user"&gt;` as the OUTERMOST element — it must be outside BrowserRouter, ThemeProvider, and I18nextProvider. This placement is critical: if MotionConfig is inside ThemeProvider, theme-toggle re-renders can interrupt in-progress animations.

    Current structure (from file): BrowserRouter > ThemeProvider > I18nextProvider > children.
    Required structure after this task: MotionConfig > BrowserRouter > ThemeProvider > I18nextProvider > children.

    The final file should be:
    ```tsx
    import { type ReactNode } from 'react';
    import { BrowserRouter } from 'react-router-dom';
    import { I18nextProvider } from 'react-i18next';
    import { MotionConfig } from 'motion/react';
    import i18n from '../i18n/config';
    import { ThemeProvider } from './ThemeProvider';

    export function AppProviders({ children }: { children: ReactNode }) {
      return (
        &lt;MotionConfig reducedMotion="user"&gt;
          &lt;BrowserRouter&gt;
            &lt;ThemeProvider&gt;
              &lt;I18nextProvider i18n={i18n}&gt;
                {children}
              &lt;/I18nextProvider&gt;
            &lt;/ThemeProvider&gt;
          &lt;/BrowserRouter&gt;
        &lt;/MotionConfig&gt;
      );
    }
    ```

    Behavior after this change: when a user has prefers-reduced-motion enabled in their OS, all x/y/scale/rotate transitions across the entire app automatically snap to their end state instantly. Opacity transitions are preserved. No per-component conditional logic is needed — ever.

    Note: the import path is `motion/react` (not `framer-motion`) — the project already uses this path convention as confirmed in variants.ts imports.
  </action>
  <verify>Run `npx tsc --noEmit` from /Users/mohamedkhair/Coding/lumiere-beaute — zero TypeScript errors. Run `npm run build` — build succeeds. Open browser at localhost:5173 — app loads, existing page transitions and nav still work.</verify>
  <done>AppProviders.tsx compiles cleanly with MotionConfig as outermost wrapper. The build produces no errors. The app runtime shows existing animations still function (page transitions, MobileMenu slide).</done>
</task>

<task type="auto">
  <name>Task 2: Extend variants.ts with scroll-reveal and stagger variant exports</name>
  <files>src/animations/variants.ts</files>
  <action>
    Append the following three exports to the END of src/animations/variants.ts, after the existing `pageFadeVariants` export. Do NOT modify the existing `pageTransitionVariants` or `pageFadeVariants` exports — they are used by live page transition components.

    Add:

    ```typescript
    /**
     * Vertical fade-up variant for scroll-reveal sections.
     * Used by FadeInSection as the whileInView target.
     * Vertical-only (y) — no RTL complication; vertical axis has no reading direction.
     * The [0.22, 1, 0.36, 1] ease matches the luxury page transition easing.
     */
    export const fadeInUpVariants: Variants = {
      hidden: { opacity: 0, y: 20 },
      visible: {
        opacity: 1,
        y: 0,
        transition: {
          duration: 0.55,
          ease: [0.22, 1, 0.36, 1] as [number, number, number, number],
        },
      },
    };

    /**
     * Parent container variant factory for staggered child reveals.
     * Returns variants with staggerChildren + delayChildren configured.
     * Children must use staggerItemVariants (or any variant with 'hidden'/'visible' keys).
     *
     * @param staggerDelay - seconds between each child; 0.06 works for up to 20 cards
     */
    export const staggerContainerVariants = (staggerDelay = 0.06): Variants => ({
      hidden: {},
      visible: {
        transition: {
          staggerChildren: staggerDelay,
          delayChildren: 0.05,
        },
      },
    });

    /**
     * Child item variant for use inside StaggerContainer.
     * Opacity + translateY only — no layout recalculation on any frame.
     */
    export const staggerItemVariants: Variants = {
      hidden: { opacity: 0, y: 16 },
      visible: {
        opacity: 1,
        y: 0,
        transition: {
          duration: 0.4,
          ease: [0.22, 1, 0.36, 1] as [number, number, number, number],
        },
      },
    };
    ```

    The `as [number, number, number, number]` cast is required for framer-motion v12 TypeScript strictness (the existing `pageTransitionVariants` uses the same cast pattern).

    The file already has `import type { Variants } from 'framer-motion'` at the top — do not change the import, these new exports use the same Variants type.
  </action>
  <verify>Run `npx tsc --noEmit` from /Users/mohamedkhair/Coding/lumiere-beaute — zero TypeScript errors. Confirm the three new names are exported: `grep -n "export const fadeInUpVariants\|export const staggerContainerVariants\|export const staggerItemVariants" src/animations/variants.ts` — all three lines found.</verify>
  <done>variants.ts exports three new named exports: fadeInUpVariants, staggerContainerVariants, staggerItemVariants. TypeScript compiles without errors. Existing exports (pageTransitionVariants, pageFadeVariants) are unchanged.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` produces a dist/ directory with no build errors
3. Dev server at localhost:5173 shows existing page transitions still work after MotionConfig addition
4. `grep "MotionConfig" src/providers/AppProviders.tsx` finds both the import and the JSX usage
5. `grep "fadeInUpVariants\|staggerContainerVariants\|staggerItemVariants" src/animations/variants.ts` returns all three exports
</verification>

<success_criteria>
- AppProviders.tsx has MotionConfig as the outermost JSX wrapper with reducedMotion="user"
- variants.ts exports fadeInUpVariants, staggerContainerVariants (factory), staggerItemVariants
- TypeScript build is clean (no errors introduced)
- Existing app behavior unchanged (page transitions, navbar, mobile menu all function)
</success_criteria>

<output>
After completion, create `.planning/phases/03-shared-components/03-01-SUMMARY.md`
</output>
