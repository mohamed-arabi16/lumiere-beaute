---
phase: 07-polish-and-ux
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/sections/ServicesTeaserSection.tsx
  - src/components/sections/TestimonialsSection.tsx
autonomous: true
requirements:
  - POL-03

must_haves:
  truths:
    - "ServicesTeaserSection heading animates with scroll-linked Y + opacity as the section scrolls into view"
    - "TestimonialsSection background section scales in as it scrolls into the center of the viewport"
    - "Both animations are continuous (scroll position drives the value) — not one-shot triggers"
    - "Both animations use only Y-axis, opacity, and scale transforms — no X-axis motion (RTL safe)"
    - "Animations respect prefers-reduced-motion via the existing MotionConfig in AppProviders"
  artifacts:
    - path: "src/components/sections/ServicesTeaserSection.tsx"
      provides: "Scroll-driven heading Y+opacity animation via useScroll+useTransform"
      contains: "useScroll"
    - path: "src/components/sections/TestimonialsSection.tsx"
      provides: "Scroll-driven background scale animation via useScroll+useTransform"
      contains: "useScroll"
  key_links:
    - from: "src/components/sections/ServicesTeaserSection.tsx"
      to: "sectionRef element"
      via: "useScroll target ref"
      pattern: "useScroll.*target.*sectionRef"
    - from: "src/components/sections/TestimonialsSection.tsx"
      to: "section element"
      via: "motion.section style scale"
      pattern: "style=.*scale.*bgScale"
---

<objective>
Add two new scroll-driven Framer Motion animations to the homepage — a Y+opacity parallax reveal on the ServicesTeaserSection heading, and a scale-in reveal on the TestimonialsSection background — using `useScroll` + `useTransform` for continuous scroll linkage (not `whileInView` one-shot triggers).

Purpose: POL-03 requires at least two distinct scroll-driven animations beyond the existing hero parallax and count-up. The research phase identified these two sections as ideal candidates: ServicesTeaserSection heading has a natural entry point, and TestimonialsSection's dark background is visually impactful when it scales in.

Output: Two updated section components with scroll-driven animations. Existing `FadeInSection` / `StaggerContainer` wrappers remain — the new animations layer on top at the section level.
</objective>

<execution_context>
@/Users/mohamedkhair/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mohamedkhair/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-polish-and-ux/07-RESEARCH.md
@src/components/sections/ServicesTeaserSection.tsx
@src/components/sections/TestimonialsSection.tsx
@src/components/sections/HeroSection.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add scroll-driven Y+opacity animation to ServicesTeaserSection heading</name>
  <files>src/components/sections/ServicesTeaserSection.tsx</files>
  <action>
    Update `ServicesTeaserSection.tsx` to add a scroll-driven heading animation using `useScroll` + `useTransform`. The section `<section>` element gets a `ref`, and the heading wrapper becomes a `motion.div` with scroll-linked `y` and `opacity` style props.

    **Implementation steps:**

    1. Add imports at top: `useRef` from `'react'`, `useScroll, useTransform` from `'framer-motion'` (already imports `motion` — add to the destructure).

    2. Inside the component function, before the return, add:
    ```typescript
    const sectionRef = useRef<HTMLElement>(null);
    const { scrollYProgress } = useScroll({
      target: sectionRef,
      offset: ['start end', 'center start'],
    });
    const headingY = useTransform(scrollYProgress, [0, 0.5], [30, 0]);
    const headingOpacity = useTransform(scrollYProgress, [0, 0.4], [0, 1]);
    ```

    3. Add `ref={sectionRef}` to the `<section>` element.

    4. Replace the existing `<FadeInSection className="text-center mb-4">` wrapper around the heading block with a `<motion.div>` that uses the scroll-linked values:
    ```tsx
    <motion.div
      className="text-center mb-4"
      style={{ y: headingY, opacity: headingOpacity }}
    >
      <Heading level={2}>
        {t('home.services_teaser.heading')}
      </Heading>
      <BodyText className="mt-3 text-jungle-teal-700 dark:text-mint-leaf-400">
        {t('home.services_teaser.subtitle')}
      </BodyText>
    </motion.div>
    ```

    Keep the `StaggerContainer` grid and the bottom `FadeInSection` CTA button wrapper unchanged — only the top heading block changes from FadeInSection to scroll-driven motion.div.

    CRITICAL: Use only `y` and `opacity` in the style prop — no `x` transforms (RTL safe per research pitfall 4). The `motion` import from `'framer-motion'` is already present; add `useScroll` and `useTransform` to the same destructure. The `useRef` import must come from `'react'`.
  </action>
  <verify>
    1. `npx tsc --noEmit 2>&1 | grep ServicesTeaserSection` — no TypeScript errors for this file
    2. `grep "useScroll\|useTransform" src/components/sections/ServicesTeaserSection.tsx` — both present
    3. `grep "style={{ y: headingY" src/components/sections/ServicesTeaserSection.tsx` — present
    4. Dev server: open homepage, scroll — ServicesTeaserSection heading fades + rises smoothly as section enters viewport
  </verify>
  <done>ServicesTeaserSection has scroll-linked Y+opacity on the heading; TypeScript compiles cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Add scroll-driven scale animation to TestimonialsSection background</name>
  <files>src/components/sections/TestimonialsSection.tsx</files>
  <action>
    Update `TestimonialsSection.tsx` to add a scroll-driven background scale animation. The `<section>` element becomes a `motion.section` with a scroll-linked `scale` style prop, creating a subtle zoom-in effect as the dark section scrolls into the center of the viewport.

    **Implementation steps:**

    1. Add imports: `useRef` from `'react'`, `useScroll, useTransform` from `'framer-motion'` (already imports `motion`).

    2. Inside the component function, before the return, add:
    ```typescript
    const testimonialsRef = useRef<HTMLElement>(null);
    const { scrollYProgress: testimonialsProgress } = useScroll({
      target: testimonialsRef,
      offset: ['start end', 'center center'],
    });
    const bgScale = useTransform(testimonialsProgress, [0, 1], [1.04, 1]);
    ```

    3. Change the `<section>` element to `<motion.section>` and add `ref={testimonialsRef}` and `style={{ scale: bgScale }}`:
    ```tsx
    <motion.section
      ref={testimonialsRef}
      style={{ scale: bgScale }}
      className="py-20 px-6 bg-surface-dark dark:bg-surface-dark"
    >
    ```

    The closing tag must become `</motion.section>`.

    Keep all inner content — `FadeInSection`, `StaggerContainer`, testimonial cards — completely unchanged.

    CRITICAL: Use `scale` only (no X-axis). `scale` is RTL-safe. The `overflow-hidden` is NOT applied to this section — the scale effect is subtle (1.04 → 1.0) and will not cause layout shift. The `AppProviders.tsx` `MotionConfig reducedMotion="user"` will automatically disable this animation for users with prefers-reduced-motion — no per-component handling needed.
  </action>
  <verify>
    1. `npx tsc --noEmit 2>&1 | grep TestimonialsSection` — no TypeScript errors for this file
    2. `grep "useScroll\|useTransform" src/components/sections/TestimonialsSection.tsx` — both present
    3. `grep "motion.section" src/components/sections/TestimonialsSection.tsx` — present
    4. `grep "scale: bgScale" src/components/sections/TestimonialsSection.tsx` — present
    5. Dev server: open homepage, scroll — TestimonialsSection dark background subtly scales from 1.04 to 1.0 as it enters center viewport
  </verify>
  <done>TestimonialsSection has scroll-driven scale on the section background; TypeScript compiles cleanly.</done>
</task>

</tasks>

<verification>
1. TypeScript: `npx tsc --noEmit` — zero errors
2. Both sections have `useScroll` + `useTransform` imports: `grep -l "useScroll" src/components/sections/`
3. Dev server: homepage scroll shows two new continuous scroll animations (Services heading Y+opacity, Testimonials scale)
4. RTL check: switch to Arabic — scroll through homepage — animations still work correctly (no X-axis flipping)
5. Both animations are distinct from existing hero parallax and count-up (different sections, different transform types)
</verification>

<success_criteria>
- ServicesTeaserSection heading uses useScroll+useTransform for Y+opacity (not whileInView)
- TestimonialsSection section element uses useScroll+useTransform for scale (not whileInView)
- Both use offset tuned to track section entry — animations play as content scrolls into view
- TypeScript compiles with zero errors
- No X-axis transforms used (RTL safe)
- Existing StaggerContainer and FadeInSection animations in both sections are preserved
</success_criteria>

<output>
After completion, create `.planning/phases/07-polish-and-ux/07-03-SUMMARY.md` following the summary template.
</output>
