---
phase: 07-polish-and-ux
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/CustomCursor.tsx
  - src/layouts/RootLayout.tsx
  - src/styles/globals.css
autonomous: true
requirements:
  - POL-04

must_haves:
  truths:
    - "A custom branded cursor replaces the default OS pointer on desktop (hover-capable devices)"
    - "The cursor is a small dot that grows into a ring when hovering over interactive elements (buttons, links, inputs)"
    - "Touch devices (mobile/tablet) show no custom cursor and no cursor:none — native touch behavior unchanged"
    - "Users with prefers-reduced-motion see static content — custom cursor is disabled for them"
    - "The cursor uses GPU-composited transforms (x/y motion values) — no top/left CSS layout properties"
    - "Custom cursor is mounted outside Navbar and AnimatedOutlet — never re-mounts on page navigation"
  artifacts:
    - path: "src/components/ui/CustomCursor.tsx"
      provides: "Branded cursor component with spring physics and hover state"
      contains: "useMotionValue, useSpring"
    - path: "src/layouts/RootLayout.tsx"
      provides: "CustomCursor mounted at root, outside Navbar and main"
      contains: "CustomCursor"
    - path: "src/styles/globals.css"
      provides: "cursor:none for hover-capable devices only"
      contains: "hover: hover"
  key_links:
    - from: "src/components/ui/CustomCursor.tsx"
      to: "window mousemove event"
      via: "useEffect listener → mouseX.set / mouseY.set"
      pattern: "addEventListener.*mousemove"
    - from: "src/components/ui/CustomCursor.tsx"
      to: "interactive elements"
      via: "mouseover + closest() delegation"
      pattern: "closest.*button.*a.*role"
    - from: "src/layouts/RootLayout.tsx"
      to: "src/components/ui/CustomCursor.tsx"
      via: "import + JSX mount"
      pattern: "<CustomCursor"
    - from: "src/styles/globals.css"
      to: "pointer devices only"
      via: "@media (hover: hover) and (pointer: fine)"
      pattern: "hover.*hover.*pointer.*fine"
---

<objective>
Create the `CustomCursor` component with spring-physics tracking and interactive hover states, mount it in `RootLayout`, and add a CSS media-query to hide the default cursor on pointer devices only.

Purpose: POL-04 requires a branded cursor on desktop that reacts to hover states on interactive elements, replacing the default OS pointer. This is the highest-impact polish feature — it immediately signals a premium bespoke experience to desktop visitors.

Output: A new `CustomCursor.tsx` component, updated `RootLayout.tsx` mounting it, and a CSS addition to `globals.css`. No new packages required — all APIs (`useMotionValue`, `useSpring`, `useReducedMotion`) exist in the installed `framer-motion` ^12.34.3.
</objective>

<execution_context>
@/Users/mohamedkhair/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mohamedkhair/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-polish-and-ux/07-RESEARCH.md
@src/layouts/RootLayout.tsx
@src/styles/globals.css
@src/providers/AppProviders.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CustomCursor component with spring physics and hover states</name>
  <files>src/components/ui/CustomCursor.tsx</files>
  <action>
    Create `src/components/ui/CustomCursor.tsx` with the following implementation:

    ```typescript
    import { useMotionValue, useSpring, motion, useReducedMotion } from 'framer-motion';
    import { useEffect, useState } from 'react';

    /**
     * CustomCursor — Branded desktop cursor with spring-physics tracking.
     *
     * Behavior:
     * - Small dot (10×10px) at rest
     * - Expands to ring (36×36px) when hovering interactive elements
     * - Hidden on touch devices via shouldReduceMotion + media CSS
     * - Respects prefers-reduced-motion (returns null if reduced)
     * - Uses x/y motion values (transform: translate) — never top/left (no reflow)
     * - Global mouseover delegation via closest() — no per-component coupling
     *
     * Mount location: RootLayout.tsx — outside Navbar and main, z-[9999]
     */
    export function CustomCursor() {
      const shouldReduceMotion = useReducedMotion();
      const [isHovering, setIsHovering] = useState(false);
      const [isVisible, setIsVisible] = useState(false);

      const mouseX = useMotionValue(0);
      const mouseY = useMotionValue(0);

      // High stiffness + moderate damping = responsive spring with slight organic lag
      const springConfig = { stiffness: 500, damping: 28 };
      const cursorX = useSpring(mouseX, springConfig);
      const cursorY = useSpring(mouseY, springConfig);

      useEffect(() => {
        const onMove = (e: MouseEvent) => {
          mouseX.set(e.clientX);
          mouseY.set(e.clientY);
          if (!isVisible) setIsVisible(true);
        };

        const onOver = (e: MouseEvent) => {
          const target = e.target as HTMLElement;
          const interactive = target.closest(
            'a, button, [role="button"], input, select, textarea, label'
          );
          setIsHovering(!!interactive);
        };

        window.addEventListener('mousemove', onMove);
        window.addEventListener('mouseover', onOver);

        return () => {
          window.removeEventListener('mousemove', onMove);
          window.removeEventListener('mouseover', onOver);
        };
      }, [mouseX, mouseY, isVisible]);

      // Return null for reduced-motion users
      if (shouldReduceMotion) return null;

      return (
        <motion.div
          aria-hidden="true"
          className="fixed top-0 left-0 pointer-events-none z-[9999] rounded-full border-2"
          style={{
            x: cursorX,
            y: cursorY,
            translateX: '-50%',
            translateY: '-50%',
          }}
          animate={{
            width: isHovering ? 36 : 10,
            height: isHovering ? 36 : 10,
            opacity: isVisible ? 1 : 0,
            borderColor: isHovering
              ? 'var(--color-celadon-200)'
              : 'var(--color-stormy-teal-950)',
          }}
          transition={{ duration: 0.12 }}
        />
      );
    }
    ```

    Key decisions:
    - `aria-hidden="true"`: cursor is decorative, not meaningful to screen readers
    - `fixed top-0 left-0` with `translateX/Y: '-50%'`: centers cursor on mouse point
    - `pointer-events-none`: cursor div never intercepts clicks
    - `z-[9999]`: always above all content including Navbar (z-50)
    - `border-2` ring with brand colors: `stormy-teal-950` at rest, `celadon-200` on hover
    - `left-0` used (not `start-0`) because mouse coordinates are physical viewport-relative; RTL has no effect
    - `isVisible` state: cursor starts invisible, becomes visible on first mouse movement (prevents flash of cursor at 0,0 on load)
  </action>
  <verify>
    1. `npx tsc --noEmit 2>&1 | grep CustomCursor` — no TypeScript errors for this file
    2. `grep "useMotionValue\|useSpring\|useReducedMotion" src/components/ui/CustomCursor.tsx` — all three present
    3. `grep "pointer-events-none\|z-\[9999\]" src/components/ui/CustomCursor.tsx` — present
    4. File exists and exports `CustomCursor` function
  </verify>
  <done>CustomCursor.tsx created with spring tracking, hover expansion, reduced-motion guard, and aria-hidden.</done>
</task>

<task type="auto">
  <name>Task 2: Mount CustomCursor in RootLayout and add CSS cursor hide</name>
  <files>
    src/layouts/RootLayout.tsx
    src/styles/globals.css
  </files>
  <action>
    **Step A — Update RootLayout.tsx:**

    Import `CustomCursor` and mount it as the first child of the root div, before `<Navbar />`:

    ```typescript
    import { CustomCursor } from '../components/ui/CustomCursor';
    ```

    Update the JSX return:
    ```tsx
    return (
      <div className="min-h-screen bg-surface-ivory dark:bg-surface-dark transition-colors duration-300">
        <CustomCursor />
        <Navbar />
        <main>
          <AnimatedOutlet />
        </main>
      </div>
    );
    ```

    `CustomCursor` is placed before `<Navbar />` so it renders first in the DOM, but its `z-[9999]` and `fixed` positioning ensures it always appears above all content visually. It mounts once in RootLayout and never re-mounts on page transitions (it is outside AnimatedOutlet/AnimatePresence).

    **Step B — Add cursor CSS to globals.css:**

    Append the following block to the end of `src/styles/globals.css`:

    ```css
    /* Custom cursor — hide default OS cursor on hover-capable pointer devices only.
       @media (hover: hover) and (pointer: fine) targets mouse/trackpad devices.
       Touch devices (mobile, tablet) are excluded — they need their native tap cursors. */
    @media (hover: hover) and (pointer: fine) {
      * {
        cursor: none !important;
      }
    }
    ```

    This media query is the only safe way to hide the cursor without breaking touch devices. The `!important` is required to override Tailwind cursor-pointer classes that components may apply.
  </action>
  <verify>
    1. `npx tsc --noEmit 2>&1 | grep RootLayout` — no TypeScript errors
    2. `grep "CustomCursor" src/layouts/RootLayout.tsx` — import and JSX mount both present
    3. `grep "hover: hover" src/styles/globals.css` — media query present
    4. `grep "cursor: none" src/styles/globals.css` — present inside media query
    5. Dev server: on desktop browser (not dev tools touch emulation), custom cursor is visible tracking the mouse; default OS cursor is hidden
  </verify>
  <done>CustomCursor mounted in RootLayout; CSS hides default cursor on pointer devices only; TypeScript compiles cleanly.</done>
</task>

</tasks>

<verification>
1. TypeScript: `npx tsc --noEmit` — zero errors
2. Dev server: move mouse on desktop — small teal dot follows with spring lag
3. Dev server: hover over any button or link — dot expands to 36×36 ring with celadon border
4. Dev server: open DevTools → toggle touch emulation — native cursor reappears, custom cursor dot not visible
5. Dev server: check performance panel — cursor animation uses transform (no top/left layout reflow)
6. `grep "cursor: none" src/styles/globals.css` inside `@media (hover: hover)` — not global
</verification>

<success_criteria>
- CustomCursor.tsx exists and exports CustomCursor function
- Spring-tracked cursor visible on desktop with branded teal ring
- Hover state detects a, button, [role=button], input, select, textarea, label via closest()
- cursor:none CSS gated under @media (hover: hover) and (pointer: fine) — touch devices unaffected
- prefers-reduced-motion: CustomCursor returns null via useReducedMotion()
- Mounted in RootLayout before Navbar — never re-mounts on page navigation
- TypeScript compiles with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-polish-and-ux/07-04-SUMMARY.md` following the summary template.
</output>
